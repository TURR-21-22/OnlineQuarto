import { socket,display,initChat,outputMessage } from './widgets/chat.js'

$( document ).ready( INIT() );

var buttonColors = ['red','green','blue','orange','purple','brown','gray','teal'];
function rndColor() { 
    let rnd = Math.floor(Math.random() * (7 - 0 + 1) + 0);
    return `button_${buttonColors[rnd]}`;
}


function INIT() {
    //const roomNameDOM = document.querySelector('#roomName');
    //const createGameForm = document.querySelector('#createGameForm');
    //const header = document.querySelector('.main-header');
    //const createGameButton = document.querySelector('#createGameButton');
    const gameListDOM = document.querySelector('.games-list');
    
    //const display = document.querySelector('.chat-display');
    //const chatInputBox = document.querySelector('.chat-input-box');
    //const chatInputButton = document.querySelector('.chat-input-button');
    //chatInputButton.addEventListener('click', (event)=>{
    //    sendMessage(chatInputBox,socket);
    //});
    //chatInputBox.addEventListener("keyup", (event)=> {
    //    if (event.key === 'Enter') {
    //        sendMessage(chatInputBox,socket);
    //    }
    //});
    //$.getScript("/js/quarto/widgets/chat.js", function() {});
    
    initChat();

    $(".create-game-form").submit(function(e) {
        e.preventDefault();
        $.ajax({
            url: "/game",
            type: "POST",
            data: {'gameroom': `${userInfo.userID}-${userInfo.name}`},
            success: function(data){
                socket.emit('createGame');
                location.href = '/game';
            }
        });
    });

    //const socket = io({transports: ['websocket'], upgrade: false});
    socket.emit(`joinToRoom`);
    socket.on(`joinedToRoom`, (msg)=>{
        if (msg !== "") {
            outputMessage(msg,display);    
        }
    });
    socket.on('message', (msg)=>{
        outputMessage(msg,display);
    })

    socket.on(`updateLobby`, (games)=>{
        updateGameList(games,gameListDOM,socket);
    });

    socket.on('gameCreated', (games,game)=>{
        updateGameList(games,gameListDOM,socket);
    })
}

function updateGameList(games,DOMelement,socket) {
    DOMelement.innerHTML = '';
    for (let i = 0; i < games.length; i++) {
        const li = document.createElement('li');
        var form = document.createElement("form");
        form.setAttribute('id','join-game-form');
        form.setAttribute("method", "post");
        var submitButton = document.createElement("input");
        submitButton.setAttribute("type", "submit");
        submitButton.value = games[i].split('-').pop();
        submitButton.classList.add("button","button_logout",rndColor());
        submitButton.setAttribute('id',`${games[i]}`);
        form.appendChild(submitButton);
        li.appendChild(form);
        DOMelement.appendChild(li);
        $("#join-game-form").submit(function(e) {
            e.preventDefault();
            $.ajax({
                url: "/game",
                type: "POST",
                data: {'gameroom': `${games[i]}`},
                success: function(data){
                    //socket.emit('joinGame',`${games[i]}`);
                    location.href = '/game';
                }
            });
        });
    }
}

// Add users to DOM
//function outputUserList(users,DOMelement) {
//    DOMelement.innerHTML = '';
//    users.forEach(user => {
//        const li = document.createElement('li');
//        li.classList.add('userButton');
//        li.innerHTML = `<div><span>${user.userID}<br>${user.name}<br>${user.room}<br>${user.socketID}</span><div>`;
//        DOMelement.appendChild(li); 
//    });
//}
//
//// Add messages to DOM
//function outputMessage(message,display) {
//    const div = document.createElement('div');
//    const span0 = document.createElement('span');
//    const span1 = document.createElement('span');
//    const span2 = document.createElement('span');
//    div.classList.add('message');
//    span0.innerHTML = `<span class="message-date">${message.time}</span><span class="message-uname">${message.username}</span><br>`;
//    span1.innerHTML = `<span class="message-text">${message.text}</span>`;
//    div.appendChild(span0);
//    div.appendChild(span1);
//    display.appendChild(div);
//}
//
//function sendMessage(DOMelement,socket) {
//    let msg = DOMelement.value;
//    if (msg != '') {
//        socket.emit('message',msg);
//        DOMelement.value = '';
//        DOMelement.focus();
//    }
//}


